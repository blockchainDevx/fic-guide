# Filecoin挖矿集群项目概况

## 1. AMD和Intel机器算力数据
基于Intel(R) Xeon(R)  E5-2696 v2 CPU 、AMD 宵龙 EPYC 7402和 2080显卡，测试出一套密封速度快的挖矿集群硬件配置，该方案有如下特点：
- 搭配优化后的软件程序，Intel的封装机器可达到平均每台机器**每天1T**的封装速度；
- 搭配优化后的软件程序，AMD的封装机器可达到平均每台机器**每天2.5T**的封装速度（官方原版程序仅**每天2T**）；
- 搭配分布式Miner程序，可解决Miner单点风险、及显卡冲突等问题；



## 2. 集群配置方案
这里的小集群适用于单节点总算力小于5PB，日封装50TB左右的挖矿集群。
整个集群划分为管理集群、封装Miner集群、计算集群、存储集群、证明Miner集群，各个子集群作用如下：

- 管理集群：跳板机和管理机，可以用一台机器，也可以分开，跳板机上要做好安全策略和登录白名单，最好使用硬件进行登录认证。

- 封装Miner集群：包含接单的Miner、密封的Miner以及Daemon，用于管理计算节点，给计算Worker派发任务，完成密封结果数据的落盘。测试时采用一台机器同时用于Miner和Daemon节点。

- 计算集群：包含PreCommit Worker和Commit Worker，完成密封计算过程，测试时两台Worker分别独立执行PreCommit(P1, P2, C1)、Commit(C2)阶段封装。

- 按照以上机器配置，Worker机器的最佳配比如下：

  | PreCommit Worker显卡 | Commit Worker显卡 | 比例  | 备注 |
  | -------------------- | ----------------- | :---: | ---- |
  | NVIDIA 2080 * 1      | NVIDIA 2080 * 2   | 3 : 2 |      |
  | NVIDIA 2080 * 1      | NVIDIA 2080 * 3   | 2 : 1 |      |

- 存储集群：采用Ceph分布式存储集群。

- 证明Miner集群：时空证明机和爆块机，还包含一台时空证明和爆块的备用机用来提高出块稳定性（非必需）。

## 3. FIL主网强制升级影响
因lotus[v1.8.0](https://github.com/filecoin-project/lotus/releases/tag/v1.8.0)版本强制在193789高度升级，导致我们优化代码编译后的lotus-miner和lotus- worker需要强制升级到最新版本。升级之后的Miner和Worker代码量修改较大，优化后的代码无法继续在新版本里正常使用。短期内无法达到目前优化后封装速度，但不影响集群的正常运行和集群的架构配置。